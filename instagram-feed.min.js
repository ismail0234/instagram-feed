var instagram={profile:[],result:[],cache:{},sizes:{},profileCount:0,timer:0,requestCount:0,limit:0,containerId:"#instagram-container",itemId:".instagram-item",urlId:".instagram-url",imageId:".instagram-image",QUERY_HASH:"58b6785bea111c67129decbe6a448951",saveCache:function(){localStorage.setItem("instagram",JSON.stringify(this.cache))},getCache:function(){var a=localStorage.getItem("instagram");return null==a?(this.saveCache(),this.getCache()):JSON.parse(a)},addProfile:function(a,b){return(this.cache=this.getCache(),this.profileCount++,"undefined"!=typeof this.cache[a])?(instagram.addProfileId(a,this.cache[a]),!0):("undefined"!=typeof b&&0<b?instagram.addProfileId(a,b):$.get(this.getSearchUrl(a),function(b){for(var c in b.users)if(b.users[c].user.username==a){instagram.addProfileId(a,b.users[c].user.pk);break}}),!0)},addProfileId:function(a,b){this.profile.push(b),this.cache[a]=b,this.profile.length==this.profileCount&&this.saveCache()},checkFinish:function(){return this.requestCount==this.profile.length},sort:function(a){return a.sort(function(c,a){return c.time>a.time?-1:1})},OnFinish:function(){var a=$(instagram.containerId);if(0>=a.length)return!1;var b=a.find(instagram.itemId);if(0>=b.length)return!1;for(var c=this.sort(instagram.result),d=0;d<b.length;d++){if("undefined"==typeof b[d])return!1;if("undefined"==typeof c[d])return!1;var e=$(b[d]).find(instagram.imageId).data("size");"undefined"==typeof e&&(e="medium"),$(b[d]).find(instagram.urlId).attr("href",c[d].url),$(b[d]).find(instagram.imageId).attr("src",c[d].image[this.sizes[e]].src)}},getSearchUrl(a){return"https://www.instagram.com/web/search/topsearch/?query="+a},getProfile:function(a){return"https://www.instagram.com/graphql/query/?query_hash="+this.QUERY_HASH+"&variables={\"id\"%3A\""+a+"\"%2C\"first\"%3A"+this.limit+"}"},getImage:function(a,b){return a.data.user.edge_owner_to_timeline_media.edges[b].node.thumbnail_resources},getUrl:function(a,b){return"https://www.instagram.com/p/"+a.data.user.edge_owner_to_timeline_media.edges[b].node.shortcode+"/"},getTimestamp:function(a,b){return a.data.user.edge_owner_to_timeline_media.edges[b].node.taken_at_timestamp},load:function(){this.sizes={},this.sizes.thumbnail=0,this.sizes.small=1,this.sizes.medium=2,this.sizes.large=3,this.sizes.xlarge=4,this.limit=$(this.containerId).find(this.itemId).length,0<this.timer&&clearInterval(this.timer),this.requestCount=0,this.result=[],this.timer=setInterval(this.loadCore,100)},loadCore:function(){if(instagram.profile.length!=instagram.profileCount)return!1;clearInterval(instagram.timer);for(var a=0;a<instagram.profile.length;a++)$.get(instagram.getProfile(instagram.profile[a]),function(a){if(instagram.requestCount++,"undefined"==typeof a.data.user.edge_owner_to_timeline_media.edges)return instagram.checkFinish()&&instagram.OnFinish(),!1;for(var b in a.data.user.edge_owner_to_timeline_media.edges){var c={};c.url=instagram.getUrl(a,b),c.image=instagram.getImage(a,b),c.time=instagram.getTimestamp(a,b),instagram.result.push(c)}instagram.checkFinish()&&instagram.OnFinish()});return!0}};
